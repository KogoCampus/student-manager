AWSTemplateFormatVersion: '2010-09-09'
Transform: AWS::Serverless-2016-10-31

Parameters:
  RedisEndpoint:
    Type: String
    Default: host.docker.internal
  RedisPort:
    Type: String
    Default: "63790"

Resources:
  EmailVerificationFunction:
    Type: AWS::Serverless::Function
    Properties:
      Handler: dist/lambda/emailVerification.handler
      Runtime: nodejs20.x
      CodeUri: .
      Environment:
        REDIS_ENDPOINT: 
          Fn::Ref: RedisEndpoint
        REDIS_PORT: 
          Fn::Ref: RedisPort
      Events:
        EmailVerification:
          Type: Api
          Properties:
            Path: /student/verify-email
            Method: post

Outputs:
  RedisEndpoint:
    Value: 
      Fn::Ref: RedisEndpoint
  RedisPort:
    Value: 
      Fn::Ref: RedisPort

openapi:
  paths:
    /student/verify-email:
      post:
        summary: Verify a student's email
        description: Generates a verification code and sends it to the email provided.
        parameters:
          - name: email
            in: query
            required: true
            description: The email address of the student to verify.
            schema:
              type: string
        responses:
          '200':
            description: Verification email sent
          '400':
            description: Bad request - missing or invalid parameters
          '500':
            description: Internal server error